{% extends "PA036SocialNetworkBundle::layout.html.twig" %}

{% block title "page title" %}

{% block head %}

<script type="text/javascript">
        function updateGroupMenu() {
            var groupId;
            {% if groupId is defined %}
                groupId = {{ groupId }}
            {% endif %}       
    
            $('#group .loading').show();
    
            $.get( "{{ path('group_my_admin') }}")
            .done(function( data ) {
                
                var response = jQuery.parseJSON(data);
                var groupsMyAdmin = response.groups;
                
                $.get( "{{ path('group_my') }}")
                .done(function( data ) {
                    $('ul#group li.group').remove();
                    
                    var activeClass = '', leaveClass = '';
                    var path = "{{ app.request.uri }}";
                    path = path.replace(path.substring(path.lastIndexOf('/') + 1), '')
                    
                    if(path.indexOf("group") === -1) {
                        path += 'group/';
                    }

                    var response = jQuery.parseJSON(data);
                    var groupsMy = response.groups;
                
                    for (var key in groupsMyAdmin) {
                        
                      if(groupId === groupsMyAdmin[key].groupId) {
                          activeClass = 'active';
                          leaveClass = 'hide';
                      } else {
                          activeClass = '';
                          leaveClass = '';
                      }
                      $('ul#group .loading').before('<li class="group clearfix '+activeClass+'"><a class="pull-left" href="'+path+groupsMyAdmin[key].groupId+'">'+groupsMyAdmin[key].name+'</a> <span class="pull-right fancybox edit" data-fancybox-href="group/edit?groupId='+groupsMyAdmin[key].groupId+'"><i class="icon-edit"></i></span> <span class="pull-right leave '+leaveClass+'" href="group/leave/'+groupsMyAdmin[key].groupId+'"><i class="icon-remove"></i></span></li>');
                    }

                    for (var key in groupsMy) {
                      
                      if(groupId === groupsMyAdmin[key].groupId) {
                          activeClass = 'active';
                          leaveClass = 'hide';
                      } else {
                          activeClass = '';
                          leaveClass = '';
                      }                       
                      $('ul#group .loading').before('<li class="group clearfix '+activeClass+'"><a class="pull-left" href="'+path+groupsMy[key].groupId+'">'+groupsMy[key].name+'</a> <span class="pull-right leave '+leaveClass+'" href="group/leave/'+groupsMy[key].groupId+'"><i class="icon-remove"></i></span></li>');
                    }
                    
                    $('#group .loading').hide();
                });   
            });  
          
        }   
        
        $(document).ready(function() {
            updateGroupMenu();
        });
        
        $(document).ready(function() {
            $(".fancybox").fancybox({
                // API options 
                autoScale: true,
                width         : 500,
                height        : 500,
                type: 'iframe',
                padding: 0,
                    beforeClose: function() {
                    updateGroupMenu();
                }
            });
        });
        
        $(document).ready(function() {    
        
            $(".leave").on("click", function() {
                
                var groupId = $(this).attr('id');
                
                $.get("{{ path('group_leave') }}", { groupId: groupId })
                .done(function( data ) {
                    var response = jQuery.parseJSON(data);
                    if(response.status === "true") {
                        $("#" + groupId).parent().hide();
                    }
                });
            });
        });
</script>

<style type="text/css">
        .group:hover {
            background: #EEEEEE;
            /*cursor: pointer;*/
        }
        .edit, .leave {
            cursor: pointer;
        }
        .active {
            color: red;
        }
</style>

{% endblock %}

{% block content %}
<div class="span3">
    <div class="well sidebar-nav">
        <ul id="group" class="nav nav-list">
            <li class="nav-header">My groups</li>
            <li><a href="#" class="fancybox" data-fancybox-href="group/add">Add group</a></li>
            <li class="loading">Loading...</li>
        </ul>
    </div><!--/.well -->
</div><!--/span-->

<div class="span9">   
    {% include 'PA036SocialNetworkBundle:Post:posts.html.twig' %}
</div>
{% endblock %}